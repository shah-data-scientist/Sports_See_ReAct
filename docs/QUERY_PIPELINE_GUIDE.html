<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NBA RAG Assistant ‚Äî Query Pipeline Guide</title>
<style>
  :root {
    --bg: #0d1117;
    --card: #161b22;
    --border: #30363d;
    --text: #c9d1d9;
    --heading: #f0f6fc;
    --accent-blue: #58a6ff;
    --accent-green: #3fb950;
    --accent-orange: #d29922;
    --accent-red: #f85149;
    --accent-purple: #bc8cff;
    --accent-teal: #39d2c0;
    --accent-pink: #f778ba;
    --muted: #8b949e;
    --yes: #3fb950;
    --no: #f85149;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Segoe UI', -apple-system, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    padding: 0;
  }

  /* ‚îÄ‚îÄ‚îÄ Header ‚îÄ‚îÄ‚îÄ */
  .header {
    text-align: center;
    padding: 40px 20px 20px;
    border-bottom: 1px solid var(--border);
    background: linear-gradient(180deg, #161b22 0%, #0d1117 100%);
  }
  .header h1 { color: var(--heading); font-size: 2rem; margin-bottom: 8px; }
  .header p { color: var(--muted); font-size: 0.95rem; max-width: 800px; margin: 0 auto; }

  /* ‚îÄ‚îÄ‚îÄ Legend ‚îÄ‚îÄ‚îÄ */
  .legend {
    display: flex; flex-wrap: wrap; gap: 16px; justify-content: center;
    padding: 16px 20px; border-bottom: 1px solid var(--border);
    background: var(--card);
  }
  .legend-item {
    display: flex; align-items: center; gap: 8px; font-size: 0.85rem;
  }
  .legend-dot {
    width: 12px; height: 12px; border-radius: 50%;
  }

  /* ‚îÄ‚îÄ‚îÄ Tabs ‚îÄ‚îÄ‚îÄ */
  .tabs {
    display: flex; flex-wrap: wrap; gap: 0; border-bottom: 2px solid var(--border);
    background: var(--card); padding: 0 20px;
  }
  .tab {
    padding: 12px 20px; cursor: pointer; border-bottom: 2px solid transparent;
    transition: all 0.2s; font-size: 0.9rem; color: var(--muted);
    margin-bottom: -2px;
  }
  .tab:hover { color: var(--heading); background: rgba(88,166,255,0.05); }
  .tab.active {
    color: var(--accent-blue); border-bottom-color: var(--accent-blue);
    font-weight: 600;
  }

  /* ‚îÄ‚îÄ‚îÄ Panel ‚îÄ‚îÄ‚îÄ */
  .panel {
    display: none; padding: 40px 20px; max-width: 1200px; margin: 0 auto;
  }
  .panel.active { display: block; }

  /* ‚îÄ‚îÄ‚îÄ Flow container ‚îÄ‚îÄ‚îÄ */
  .flow {
    display: flex; flex-direction: column; align-items: center; gap: 0;
    width: 100%; max-width: 900px; margin: 0 auto;
  }

  /* ‚îÄ‚îÄ‚îÄ Nodes ‚îÄ‚îÄ‚îÄ */
  .node {
    background: var(--card);
    border: 2px solid var(--border);
    border-radius: 10px;
    padding: 16px 20px;
    min-width: 320px;
    max-width: 600px;
    width: 100%;
    transition: all 0.2s;
    position: relative;
  }
  .node:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
  }

  .node-start {
    background: linear-gradient(135deg, #1a2a3a, #0d1a2a);
    border-color: var(--accent-blue);
  }
  .node-decision {
    background: linear-gradient(135deg, #3a2a1a, #2a1a0d);
    border-color: var(--accent-orange);
    border-style: dashed;
  }
  .node-decision::before {
    content: ''; position: absolute; top: -1px; right: -1px;
    width: 24px; height: 24px; background: var(--accent-orange);
    clip-path: polygon(0 0, 100% 0, 100% 100%);
    border-radius: 0 9px 0 0; opacity: 0.3;
  }
  .node-process {
    background: var(--card);
    border-color: var(--accent-blue);
  }
  .node-sql {
    background: linear-gradient(135deg, #1a2a3a, #0d1a2a);
    border-color: var(--accent-blue);
  }
  .node-vector {
    background: linear-gradient(135deg, #2a1a3a, #1a0d2a);
    border-color: var(--accent-purple);
  }
  .node-hybrid {
    background: linear-gradient(135deg, #1a3a3a, #0d2a2a);
    border-color: var(--accent-teal);
  }
  .node-output {
    background: linear-gradient(135deg, #1a3a2a, #0d2818);
    border-color: var(--accent-green);
  }
  .node-tool {
    background: var(--card);
    border-color: var(--accent-pink);
  }

  .node-label {
    font-size: 0.72rem; text-transform: uppercase; letter-spacing: 1px;
    margin-bottom: 6px; font-weight: 600;
  }
  .node-label.blue { color: var(--accent-blue); }
  .node-label.orange { color: var(--accent-orange); }
  .node-label.green { color: var(--accent-green); }
  .node-label.purple { color: var(--accent-purple); }
  .node-label.teal { color: var(--accent-teal); }
  .node-label.pink { color: var(--accent-pink); }

  .node-title { font-size: 1.05rem; font-weight: 600; color: var(--heading); margin-bottom: 4px; }
  .node-detail { font-size: 0.85rem; color: var(--muted); line-height: 1.5; }
  .node-detail code {
    background: rgba(110,118,129,0.15); padding: 1px 5px; border-radius: 3px;
    font-family: 'Cascadia Code', 'Fira Code', monospace; font-size: 0.82rem;
    color: var(--accent-teal);
  }
  .node-detail strong { color: var(--heading); }
  .node-detail ul {
    margin: 8px 0 0 20px;
  }
  .node-detail li {
    margin: 4px 0;
  }

  /* ‚îÄ‚îÄ‚îÄ Arrows ‚îÄ‚îÄ‚îÄ */
  .arrow {
    display: flex; flex-direction: column; align-items: center; gap: 0;
    position: relative; min-height: 36px;
  }
  .arrow-line {
    width: 2px; height: 20px; background: var(--border);
  }
  .arrow-head {
    width: 0; height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-top: 8px solid var(--border);
  }
  .arrow-label {
    font-size: 0.75rem; color: var(--muted);
    background: var(--bg); padding: 1px 8px; border-radius: 10px;
    border: 1px solid var(--border); margin: 2px 0;
    white-space: nowrap;
  }
  .arrow-label.yes { color: var(--yes); border-color: var(--yes); }
  .arrow-label.no { color: var(--no); border-color: var(--no); }

  /* ‚îÄ‚îÄ‚îÄ Branch (side-by-side paths) ‚îÄ‚îÄ‚îÄ */
  .branch {
    display: flex; gap: 20px; width: 100%; max-width: 1100px;
    justify-content: center; align-items: flex-start;
    margin: 20px 0;
  }
  .branch-path {
    flex: 1; display: flex; flex-direction: column; align-items: center; gap: 12px;
    max-width: 350px;
  }
  .branch-label {
    font-size: 0.78rem; font-weight: 600; padding: 6px 14px;
    border-radius: 12px; margin-bottom: 8px; text-align: center;
  }
  .branch-label.sql { background: rgba(88,166,255,0.15); color: var(--accent-blue); border: 1px solid rgba(88,166,255,0.3); }
  .branch-label.vector { background: rgba(188,140,255,0.15); color: var(--accent-purple); border: 1px solid rgba(188,140,255,0.3); }
  .branch-label.hybrid { background: rgba(57,210,192,0.15); color: var(--accent-teal); border: 1px solid rgba(57,210,192,0.3); }

  /* ‚îÄ‚îÄ‚îÄ Info boxes ‚îÄ‚îÄ‚îÄ */
  .info-grid {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 16px; margin-top: 20px;
  }
  .info-box {
    background: var(--card); border: 1px solid var(--border); border-radius: 8px;
    padding: 16px; font-size: 0.85rem;
  }
  .info-box h4 { color: var(--heading); margin-bottom: 8px; font-size: 0.95rem; }
  .info-box ul { padding-left: 18px; margin: 8px 0; }
  .info-box li { margin-bottom: 4px; color: var(--text); }
  .info-box li code { color: var(--accent-teal); background: rgba(110,118,129,0.15); padding: 1px 4px; border-radius: 3px; font-size: 0.82rem; }
  .info-box .metric {
    display: flex; justify-content: space-between; align-items: center;
    padding: 8px 0; border-bottom: 1px solid var(--border);
  }
  .info-box .metric:last-child { border-bottom: none; }
  .info-box .metric-label { color: var(--muted); }
  .info-box .metric-value { color: var(--accent-green); font-weight: 600; }

  /* ‚îÄ‚îÄ‚îÄ Tags ‚îÄ‚îÄ‚îÄ */
  .tag {
    display: inline-block; font-size: 0.75rem; padding: 2px 8px;
    border-radius: 10px; font-weight: 500; margin: 2px;
  }
  .tag-sql { background: rgba(88,166,255,0.15); color: var(--accent-blue); }
  .tag-vector { background: rgba(188,140,255,0.15); color: var(--accent-purple); }
  .tag-hybrid { background: rgba(57,210,192,0.15); color: var(--accent-teal); }
  .tag-fast { background: rgba(63,185,80,0.15); color: var(--accent-green); }
  .tag-slow { background: rgba(248,81,73,0.15); color: var(--accent-red); }

  /* ‚îÄ‚îÄ‚îÄ Table ‚îÄ‚îÄ‚îÄ */
  .example-table {
    width: 100%; border-collapse: collapse; margin: 20px 0;
  }
  .example-table th, .example-table td {
    padding: 12px; text-align: left; border-bottom: 1px solid var(--border);
    font-size: 0.85rem;
  }
  .example-table th {
    color: var(--heading); font-weight: 600;
    background: rgba(22,27,34,0.8);
  }
  .example-table td { color: var(--text); }
  .example-table tr:hover td { background: rgba(88,166,255,0.05); }

  /* ‚îÄ‚îÄ‚îÄ Code block ‚îÄ‚îÄ‚îÄ */
  .code-block {
    background: rgba(22,27,34,0.8);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 16px;
    margin: 16px 0;
    overflow-x: auto;
  }
  .code-block code {
    font-family: 'Cascadia Code', 'Fira Code', monospace;
    font-size: 0.85rem;
    color: var(--accent-teal);
    line-height: 1.6;
  }

  /* ‚îÄ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ‚îÄ */
  @media (max-width: 800px) {
    .branch { flex-direction: column; align-items: center; }
    .branch-path { max-width: 100%; }
    .info-grid { grid-template-columns: 1fr; }
    .node { min-width: 280px; }
  }

  /* ‚îÄ‚îÄ‚îÄ Section ‚îÄ‚îÄ‚îÄ */
  .section-title {
    font-size: 1.4rem;
    color: var(--heading);
    margin: 30px 0 20px 0;
    padding-bottom: 10px;
    border-bottom: 2px solid var(--border);
  }
  .section-subtitle {
    font-size: 1.1rem;
    color: var(--accent-blue);
    margin: 20px 0 12px 0;
  }
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HEADER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="header">
  <h1>üèÄ NBA RAG Assistant ‚Äî Query Pipeline Guide</h1>
  <p>Interactive visualization of the ReAct agent architecture: query classification, tool execution, and response generation.
     Explore each query type and see how the system intelligently routes requests.</p>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LEGEND ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="legend">
  <div class="legend-item"><div class="legend-dot" style="background:var(--accent-blue)"></div> SQL / Process</div>
  <div class="legend-item"><div class="legend-dot" style="background:var(--accent-orange)"></div> Decision Point</div>
  <div class="legend-item"><div class="legend-dot" style="background:var(--accent-green)"></div> Output / Success</div>
  <div class="legend-item"><div class="legend-dot" style="background:var(--accent-purple)"></div> Vector Search</div>
  <div class="legend-item"><div class="legend-dot" style="background:var(--accent-teal)"></div> Hybrid Path</div>
  <div class="legend-item"><div class="legend-dot" style="background:var(--accent-pink)"></div> Tool Execution</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TABS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="tabs">
  <div class="tab active" onclick="switchTab('overview')">Pipeline Overview</div>
  <div class="tab" onclick="switchTab('classification')">Query Classification</div>
  <div class="tab" onclick="switchTab('sql')">SQL-Only Path</div>
  <div class="tab" onclick="switchTab('vector')">Vector-Only Path</div>
  <div class="tab" onclick="switchTab('hybrid')">Hybrid Path</div>
  <div class="tab" onclick="switchTab('tools')">Tool Details</div>
  <div class="tab" onclick="switchTab('data')">Data Pipeline</div>
  <div class="tab" onclick="switchTab('examples')">Examples & Metrics</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB 1: PIPELINE OVERVIEW
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="panel-overview" class="panel active">
  <div class="flow">

    <!-- Entry Point -->
    <div class="node node-start">
      <div class="node-label blue">ENTRY POINT</div>
      <div class="node-title">User Query Received</div>
      <div class="node-detail"><code>POST /api/v1/chat</code> ‚Üí <code>ChatService.chat(request)</code></div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <!-- Sanitize -->
    <div class="node node-process">
      <div class="node-label blue">SECURITY</div>
      <div class="node-title">Sanitize Query</div>
      <div class="node-detail"><code>sanitize_query()</code> ‚Äî XSS protection, SQL injection prevention, length validation</div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <!-- Build Context -->
    <div class="node node-process">
      <div class="node-label blue">CONTEXT</div>
      <div class="node-title">Build Conversation Context</div>
      <div class="node-detail">Fetch previous conversation turns from database if <code>conversation_id</code> provided</div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <!-- Initialize Agent -->
    <div class="node node-process">
      <div class="node-label blue">INITIALIZATION</div>
      <div class="node-title">Initialize ReAct Agent</div>
      <div class="node-detail">
        Lazy initialization of tools (only on first request):
        <ul>
          <li>NBAGSQLTool (SQL database)</li>
          <li>VectorStoreRepository (FAISS)</li>
          <li>EmbeddingService (Google embeddings)</li>
          <li>VisualizationService (Altair charts)</li>
        </ul>
      </div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <!-- Greeting Check -->
    <div class="node node-decision">
      <div class="node-label orange">DECISION 1</div>
      <div class="node-title">Is it a simple greeting?</div>
      <div class="node-detail">
        <code>_is_simple_greeting()</code><br><br>
        <strong>‚úÖ Greetings (early return):</strong><br>
        "hi", "hello", "hey", "thanks", "bye"
      </div>
    </div>

    <div class="arrow">
      <div class="arrow-line"></div>
      <div class="arrow-label yes">YES</div>
      <div class="arrow-head"></div>
    </div>

    <!-- Greeting Response -->
    <div class="node node-output">
      <div class="node-label green">EARLY RETURN</div>
      <div class="node-title">Return Greeting Response</div>
      <div class="node-detail">
        <strong>Response Time:</strong> &lt;500ms (no tool execution)<br>
        "Hello! I'm your NBA statistics assistant. Ask me anything!"
      </div>
    </div>

    <div class="arrow">
      <div class="arrow-line"></div>
      <div class="arrow-label no">NO - Continue</div>
      <div class="arrow-head"></div>
    </div>

    <!-- Query Classification -->
    <div class="node node-decision">
      <div class="node-label orange">DECISION 2 ‚Äî CLASSIFICATION</div>
      <div class="node-title">Classify Query Type</div>
      <div class="node-detail">
        <strong>Stage 1: Heuristic Classification</strong> (70% of queries, confidence-based)<br>
        <strong>Stage 2: LLM Fallback</strong> (30% of queries, confidence &lt; 0.9)<br><br>
        <strong>Classification:</strong> <span class="tag-sql">sql_only</span> <span class="tag-vector">vector_only</span> <span class="tag-hybrid">hybrid</span>
      </div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <!-- Branch into 3 paths -->
    <div class="branch">
      <!-- SQL-Only Path -->
      <div class="branch-path">
        <div class="branch-label sql">SQL-ONLY PATH</div>
        <div class="node node-sql" style="min-width: 280px;">
          <div class="node-label blue">TOOL</div>
          <div class="node-title">query_nba_database</div>
          <div class="node-detail">
            Execute SQL query<br>
            Return stats + visualization
          </div>
        </div>
        <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>
        <div style="font-size: 0.75rem; color: var(--muted); text-align: center;">
          ‚è±Ô∏è 2-4 seconds
        </div>
      </div>

      <!-- Vector-Only Path -->
      <div class="branch-path">
        <div class="branch-label vector">VECTOR-ONLY PATH</div>
        <div class="node node-vector" style="min-width: 280px;">
          <div class="node-label purple">TOOL</div>
          <div class="node-title">search_knowledge_base</div>
          <div class="node-detail">
            Vector search<br>
            Return Reddit discussions
          </div>
        </div>
        <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>
        <div style="font-size: 0.75rem; color: var(--muted); text-align: center;">
          ‚è±Ô∏è 1-2 seconds<br><span class="tag-fast">FASTEST</span>
        </div>
      </div>

      <!-- Hybrid Path -->
      <div class="branch-path">
        <div class="branch-label hybrid">HYBRID PATH</div>
        <div class="node node-hybrid" style="min-width: 280px;">
          <div class="node-label teal">SEQUENTIAL</div>
          <div class="node-title">SQL + Vector</div>
          <div class="node-detail">
            1. SQL query<br>
            2. Extract entities<br>
            3. Vector search (enriched)
          </div>
        </div>
        <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>
        <div style="font-size: 0.75rem; color: var(--muted); text-align: center;">
          ‚è±Ô∏è 4-7 seconds
        </div>
      </div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <!-- Merge -->
    <div class="node node-output">
      <div class="node-label green">RESPONSE GENERATION</div>
      <div class="node-title">Generate Final Answer</div>
      <div class="node-detail">
        LLM synthesis using tool results (Gemini 2.0 Flash, temp=0.1)<br>
        Return <code>ChatResponse</code> with answer, sources, visualization
      </div>
    </div>

  </div>

  <div class="info-grid">
    <div class="info-box">
      <h4>üéØ Success Metrics</h4>
      <div class="metric">
        <span class="metric-label">Classification Accuracy</span>
        <span class="metric-value">94%</span>
      </div>
      <div class="metric">
        <span class="metric-label">SQL Success Rate</span>
        <span class="metric-value">87%</span>
      </div>
      <div class="metric">
        <span class="metric-label">Vector Relevance</span>
        <span class="metric-value">95%</span>
      </div>
    </div>

    <div class="info-box">
      <h4>‚ö° Performance</h4>
      <div class="metric">
        <span class="metric-label">SQL-Only Queries</span>
        <span class="metric-value">2-4s</span>
      </div>
      <div class="metric">
        <span class="metric-label">Vector-Only Queries</span>
        <span class="metric-value">1-2s</span>
      </div>
      <div class="metric">
        <span class="metric-label">Hybrid Queries</span>
        <span class="metric-value">4-7s</span>
      </div>
      <div class="metric">
        <span class="metric-label">Greetings (Early Return)</span>
        <span class="metric-value">&lt;500ms</span>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB 2: QUERY CLASSIFICATION
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="panel-classification" class="panel">
  <h2 class="section-title">üß† Query Classification Strategy</h2>

  <div class="flow">
    <div class="node node-start">
      <div class="node-label blue">INPUT</div>
      <div class="node-title">User Question</div>
      <div class="node-detail">Example: "Who is Nikola Jokiƒá and why is he great?"</div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <div class="node node-decision">
      <div class="node-label orange">STAGE 1 ‚Äî HEURISTIC</div>
      <div class="node-title">Heuristic Classification with Confidence</div>
      <div class="node-detail">
        <strong>Fast pattern matching:</strong><br>
        ‚Ä¢ Detect signal patterns in query<br>
        ‚Ä¢ Calculate confidence score (0-1)<br>
        ‚Ä¢ Return type + confidence<br><br>
        <strong>Coverage:</strong> 70% of queries
      </div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <div class="node node-decision">
      <div class="node-label orange">CONFIDENCE CHECK</div>
      <div class="node-title">Confidence ‚â• 0.9?</div>
      <div class="node-detail">
        High confidence ‚Üí Use heuristic result<br>
        Low confidence ‚Üí Use LLM classification
      </div>
    </div>

    <div class="branch">
      <div class="branch-path">
        <div class="branch-label sql" style="background: rgba(63,185,80,0.15); color: var(--accent-green);">
          HIGH CONFIDENCE ‚â• 0.9
        </div>
        <div class="node node-output" style="min-width: 280px;">
          <div class="node-label green">HEURISTIC RESULT</div>
          <div class="node-title">Use Heuristic Classification</div>
          <div class="node-detail">
            <strong>Benefit:</strong> No LLM call<br>
            <strong>Speed:</strong> ~200-300ms faster<br>
            <strong>Cost:</strong> $0 (no API call)
          </div>
        </div>
      </div>

      <div class="branch-path">
        <div class="branch-label vector" style="background: rgba(248,81,73,0.15); color: var(--accent-red);">
          LOW CONFIDENCE &lt; 0.9
        </div>
        <div class="node node-process" style="min-width: 280px;">
          <div class="node-label orange">STAGE 2 ‚Äî LLM</div>
          <div class="node-title">LLM Classification</div>
          <div class="node-detail">
            Call Gemini 2.0 Flash<br>
            <code>temperature=0.0</code><br>
            Prompt caching enabled
          </div>
        </div>
        <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>
        <div class="node node-output" style="min-width: 280px;">
          <div class="node-label green">LLM RESULT</div>
          <div class="node-title">Accurate Classification</div>
          <div class="node-detail">
            <strong>Accuracy:</strong> 98%<br>
            <strong>Speed:</strong> +200-300ms<br>
            <strong>Cost:</strong> Minimal (cached)
          </div>
        </div>
      </div>
    </div>
  </div>

  <h3 class="section-subtitle">Signal Detection Patterns</h3>

  <div class="info-grid">
    <div class="info-box">
      <h4>üîµ SQL-Only Signals (Confidence: 0.85)</h4>
      <ul>
        <li><code>top</code>, <code>most</code>, <code>highest</code>, <code>lowest</code></li>
        <li><code>average</code>, <code>total</code>, <code>rank</code>, <code>leader</code></li>
        <li><code>scored</code>, <code>points</code>, <code>rebounds</code>, <code>assists</code></li>
        <li><code>compare X vs Y</code>, <code>stats</code>, <code>statistics</code></li>
      </ul>
      <strong>Example:</strong> "Who are the top 5 scorers?"
    </div>

    <div class="info-box">
      <h4>üü£ Vector-Only Signals (Confidence: 0.8)</h4>
      <ul>
        <li><code>why</code>, <code>how</code>, <code>what do</code>, <code>what are</code></li>
        <li><code>opinion</code>, <code>think</code>, <code>believe</code>, <code>debate</code></li>
        <li><code>style</code>, <code>strategy</code>, <code>approach</code></li>
        <li><code>makes them/him</code>, <code>playing style</code></li>
      </ul>
      <strong>Strong Signals (Confidence: 0.95):</strong><br>
      <code>what do fans think</code>, <code>fan reactions</code>, <code>debate about</code>
    </div>

    <div class="info-box">
      <h4>üü¢ Hybrid Signals (Confidence: 0.7)</h4>
      <ul>
        <li><code>who is</code> ‚Äî Biographical queries</li>
        <li><code>tell me about</code> ‚Äî Overview requests</li>
        <li><code>what about</code> ‚Äî General inquiries</li>
      </ul>
      <strong>Example:</strong> "Who is Nikola Jokiƒá?"<br>
      ‚Üí Needs both stats AND context
    </div>
  </div>

  <h3 class="section-subtitle">Classification Examples</h3>

  <table class="example-table">
    <thead>
      <tr>
        <th>Query</th>
        <th>Classification</th>
        <th>Confidence</th>
        <th>Method</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>"Top 5 scorers this season"</td>
        <td><span class="tag-sql">sql_only</span></td>
        <td>0.95</td>
        <td>Heuristic (signals: "top", "scorers")</td>
      </tr>
      <tr>
        <td>"Why is LeBron great?"</td>
        <td><span class="tag-vector">vector_only</span></td>
        <td>0.90</td>
        <td>Heuristic (signals: "why", "great")</td>
      </tr>
      <tr>
        <td>"What do fans think about Lakers?"</td>
        <td><span class="tag-vector">vector_only</span></td>
        <td>0.95</td>
        <td>Heuristic (strong signal: "what do fans think")</td>
      </tr>
      <tr>
        <td>"Who is Nikola Jokiƒá?"</td>
        <td><span class="tag-hybrid">hybrid</span></td>
        <td>0.70 ‚Üí LLM</td>
        <td>LLM (low confidence, needs both stats + context)</td>
      </tr>
      <tr>
        <td>"Tell me about the Warriors"</td>
        <td><span class="tag-hybrid">hybrid</span></td>
        <td>0.75 ‚Üí LLM</td>
        <td>LLM (ambiguous - could need stats or just context)</td>
      </tr>
    </tbody>
  </table>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB 3: SQL-ONLY PATH
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="panel-sql" class="panel">
  <h2 class="section-title">üîµ SQL-Only Query Path</h2>

  <div class="flow">
    <div class="node node-start">
      <div class="node-label blue">QUERY TYPE</div>
      <div class="node-title">SQL-Only Classification</div>
      <div class="node-detail">
        <strong>Characteristics:</strong> Pure statistical queries<br>
        <strong>Examples:</strong> "Top 5 scorers", "Average PPG", "Compare Jokiƒá vs Embiid"
      </div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <div class="node node-tool">
      <div class="node-label pink">TOOL EXECUTION</div>
      <div class="node-title">query_nba_database(question)</div>
      <div class="node-detail">
        <strong>Technology:</strong> LangChain SQL Agent<br>
        <strong>Process:</strong>
        <ul>
          <li>Convert natural language to SQL</li>
          <li>Execute against PostgreSQL database</li>
          <li>Return structured results</li>
          <li>Format answer text</li>
        </ul>
      </div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <div class="node node-decision">
      <div class="node-label orange">VISUALIZATION CHECK</div>
      <div class="node-title">Should create visualization?</div>
      <div class="node-detail">
        <strong>Criteria:</strong><br>
        ‚Ä¢ ‚â•2 rows of results<br>
        ‚Ä¢ Contains numeric columns<br>
        ‚Ä¢ Visualization would add value
      </div>
    </div>

    <div class="arrow">
      <div class="arrow-line"></div>
      <div class="arrow-label yes">YES</div>
      <div class="arrow-head"></div>
    </div>

    <div class="node node-tool">
      <div class="node-label pink">AUTO-VISUALIZATION</div>
      <div class="node-title">create_visualization(sql_results)</div>
      <div class="node-detail">
        Generate Vega-Lite chart spec (bar, line, scatter)<br>
        Include title, axes labels, accessibility description
      </div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <div class="node node-output">
      <div class="node-label green">RESPONSE</div>
      <div class="node-title">SQL-Only Response</div>
      <div class="node-detail">
        <strong>Contains:</strong><br>
        ‚Ä¢ Answer text (formatted by SQL agent)<br>
        ‚Ä¢ SQL query (for transparency)<br>
        ‚Ä¢ Results data<br>
        ‚Ä¢ Visualization (if created)<br><br>
        <strong>Response Time:</strong> 2-4 seconds
      </div>
    </div>
  </div>

  <h3 class="section-subtitle">Database Schema</h3>

  <div class="info-grid">
    <div class="info-box">
      <h4>üìä players</h4>
      <ul>
        <li><code>id</code> ‚Äî Player ID (primary key)</li>
        <li><code>name</code> ‚Äî Player name</li>
        <li><code>age</code> ‚Äî Age</li>
        <li><code>height</code> ‚Äî Height (cm)</li>
        <li><code>weight</code> ‚Äî Weight (kg)</li>
        <li><code>team_id</code> ‚Äî Foreign key to teams</li>
      </ul>
    </div>

    <div class="info-box">
      <h4>üìä player_stats</h4>
      <ul>
        <li><code>player_id</code> ‚Äî Foreign key to players</li>
        <li><code>gp</code> ‚Äî Games played</li>
        <li><code>pts</code> ‚Äî Total points</li>
        <li><code>reb</code> ‚Äî Total rebounds</li>
        <li><code>ast</code> ‚Äî Total assists</li>
        <li><code>fg_pct</code>, <code>three_pct</code>, <code>ft_pct</code> ‚Äî Shooting %</li>
      </ul>
    </div>

    <div class="info-box">
      <h4>üìä teams</h4>
      <ul>
        <li><code>id</code> ‚Äî Team ID (primary key)</li>
        <li><code>name</code> ‚Äî Team name</li>
        <li><code>city</code> ‚Äî City</li>
        <li><code>conference</code> ‚Äî East or West</li>
      </ul>
    </div>
  </div>

  <h3 class="section-subtitle">Example SQL Query Flow</h3>

  <div class="code-block">
    <code><strong>User Query:</strong> "Who are the top 5 scorers this season?"

<strong>Generated SQL:</strong>
SELECT p.name, ROUND(ps.pts*1.0/ps.gp, 1) as ppg
FROM players p
JOIN player_stats ps ON p.id = ps.player_id
WHERE ps.gp > 0
ORDER BY ppg DESC
LIMIT 5

<strong>Results:</strong>
[
  {"name": "Shai Gilgeous-Alexander", "ppg": 32.7},
  {"name": "Giannis Antetokounmpo", "ppg": 30.4},
  {"name": "Nikola Jokiƒá", "ppg": 29.6},
  {"name": "Luka Donƒçiƒá", "ppg": 28.2},
  {"name": "Anthony Edwards", "ppg": 27.6}
]

<strong>Visualization:</strong> Bar chart (player names vs PPG)

<strong>Answer:</strong>
"The top 5 scorers this season are:
1. Shai Gilgeous-Alexander - 32.7 PPG
2. Giannis Antetokounmpo - 30.4 PPG
3. Nikola Jokiƒá - 29.6 PPG
4. Luka Donƒçiƒá - 28.2 PPG
5. Anthony Edwards - 27.6 PPG"</code>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB 4: VECTOR-ONLY PATH
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="panel-vector" class="panel">
  <h2 class="section-title">üü£ Vector-Only Query Path</h2>

  <div class="flow">
    <div class="node node-start">
      <div class="node-label purple">QUERY TYPE</div>
      <div class="node-title">Vector-Only Classification</div>
      <div class="node-detail">
        <strong>Characteristics:</strong> Opinion/context queries<br>
        <strong>Examples:</strong> "Why is LeBron great?", "What do fans think?", "Playing style analysis"
      </div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <div class="node node-tool">
      <div class="node-label pink">TOOL EXECUTION</div>
      <div class="node-title">search_knowledge_base(query, k=5)</div>
      <div class="node-detail">
        <strong>Technology:</strong> FAISS + Google Embeddings<br>
        <strong>Process:</strong>
        <ul>
          <li>Generate query embedding</li>
          <li>Vector similarity search (IndexFlatIP)</li>
          <li><strong>3-Signal Hybrid Scoring:</strong>
            <ul style="margin-top: 4px;">
              <li>Cosine similarity (70%)</li>
              <li>BM25 term matching (15%)</li>
              <li>Quality boost (15%)</li>
            </ul>
          </li>
          <li>Return top-k Reddit discussions</li>
          <li>Include source URLs and metadata</li>
        </ul>
      </div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <div class="node node-output">
      <div class="node-label green">RESPONSE</div>
      <div class="node-title">Vector-Only Response</div>
      <div class="node-detail">
        <strong>Contains:</strong><br>
        ‚Ä¢ Synthesized answer from discussions<br>
        ‚Ä¢ Source links to original Reddit posts<br>
        ‚Ä¢ Similarity scores<br><br>
        <strong>Response Time:</strong> 1-2 seconds <span class="tag-fast">FASTEST</span>
      </div>
    </div>
  </div>

  <h3 class="section-subtitle">Vector Store Details</h3>

  <div class="info-grid">
    <div class="info-box">
      <h4>üìö Knowledge Base Corpus</h4>
      <ul>
        <li><strong>Source:</strong> r/nba subreddit</li>
        <li><strong>Size:</strong> ~10,000 discussions</li>
        <li><strong>Content:</strong> Player analysis, debates, game threads, MVP discussions</li>
        <li><strong>Chunk Size:</strong> 1,000 tokens</li>
        <li><strong>Overlap:</strong> 200 tokens</li>
      </ul>
    </div>

    <div class="info-box">
      <h4>üîç Search Configuration</h4>
      <ul>
        <li><strong>Embedding Model:</strong> text-embedding-004 (Google)</li>
        <li><strong>Vector DB:</strong> FAISS (Facebook AI Similarity Search)</li>
        <li><strong>Index:</strong> IndexFlatIP (exact cosine similarity)</li>
        <li><strong>Scoring:</strong> 3-signal hybrid (Cosine 70% + BM25 15% + Quality 15%)</li>
        <li><strong>Default k:</strong> 5 results</li>
        <li><strong>Similarity Threshold:</strong> 0.7</li>
      </ul>
    </div>

    <div class="info-box">
      <h4>‚ö° Performance</h4>
      <div class="metric">
        <span class="metric-label">Embedding Generation</span>
        <span class="metric-value">~50ms</span>
      </div>
      <div class="metric">
        <span class="metric-label">Vector Search</span>
        <span class="metric-value">~50-100ms</span>
      </div>
      <div class="metric">
        <span class="metric-label">Total Tool Execution</span>
        <span class="metric-value">~200-300ms</span>
      </div>
      <div class="metric">
        <span class="metric-label">Relevance Rate</span>
        <span class="metric-value">95%</span>
      </div>
    </div>
  </div>

  <h3 class="section-subtitle">Example Vector Search Flow</h3>

  <div class="code-block">
    <code><strong>User Query:</strong> "What do fans think about the Lakers this season?"

<strong>Query Embedding:</strong> [0.021, -0.043, 0.087, ...] (768 dimensions)

<strong>Vector Search Results (k=5):</strong>
[
  {
    "content": "Lakers are struggling without AD. Defense is porous...",
    "metadata": {
      "source": "reddit_nba",
      "title": "Lakers Defense Issues - Discussion Thread",
      "url": "https://reddit.com/r/nba/...",
      "score": 0.89
    }
  },
  {
    "content": "LeBron still playing at elite level at 39. Insane longevity...",
    "metadata": {
      "source": "reddit_nba",
      "title": "LeBron's Performance This Season",
      "url": "https://reddit.com/r/nba/...",
      "score": 0.85
    }
  },
  ...
]

<strong>Answer:</strong>
"Based on fan discussions, there are mixed opinions about the Lakers this season:

**Concerns:**
- Defensive struggles, especially without Anthony Davis
- Inconsistent roster performance
- Injury issues affecting team chemistry

**Positives:**
- LeBron James continues to play at an elite level despite his age
- Strong offensive firepower when healthy
- Potential for playoff push with full roster

Fans remain hopeful but acknowledge the team needs better consistency and health.

**Sources:**
- [Lakers Defense Issues - Discussion Thread](https://reddit.com/r/nba/...)
- [LeBron's Performance This Season](https://reddit.com/r/nba/...)"</code>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB 5: HYBRID PATH
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="panel-hybrid" class="panel">
  <h2 class="section-title">üü¢ Hybrid Query Path</h2>

  <div class="flow">
    <div class="node node-start">
      <div class="node-label teal">QUERY TYPE</div>
      <div class="node-title">Hybrid Classification</div>
      <div class="node-detail">
        <strong>Characteristics:</strong> Needs BOTH stats AND context<br>
        <strong>Examples:</strong> "Who is Nikola Jokiƒá?", "Tell me about Giannis", "Top scorers and why they're effective"
      </div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <div class="node node-tool">
      <div class="node-label pink">TOOL 1 ‚Äî SQL</div>
      <div class="node-title">query_nba_database(question)</div>
      <div class="node-detail">
        Execute SQL query to get statistical data<br>
        <strong>Example:</strong> Player stats, achievements, team info
      </div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <div class="node node-process">
      <div class="node-label teal">ENTITY EXTRACTION</div>
      <div class="node-title">Extract Entities from SQL Results</div>
      <div class="node-detail">
        Parse SQL results for entity names:<br>
        ‚Ä¢ Player names (<code>name</code>, <code>player_name</code>)<br>
        ‚Ä¢ Team names (<code>team_name</code>, <code>team</code>)<br><br>
        <strong>Example:</strong> ["Nikola Jokiƒá", "Denver Nuggets"]
      </div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <div class="node node-process">
      <div class="node-label teal">QUERY ENRICHMENT</div>
      <div class="node-title">Enrich Query with Entities</div>
      <div class="node-detail">
        <strong>Transformations:</strong><br>
        ‚Ä¢ Replace pronouns (he/him ‚Üí entity name)<br>
        ‚Ä¢ Remove question words (why/how/what)<br>
        ‚Ä¢ Add relevant keywords (MVP, style, impact)<br><br>
        <strong>Input:</strong> "Why is he great?"<br>
        <strong>Output:</strong> "Nikola Jokiƒá MVP impact playing style great player"
      </div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <div class="node node-tool">
      <div class="node-label pink">TOOL 2 ‚Äî VECTOR</div>
      <div class="node-title">search_knowledge_base(enriched_query, k=5)</div>
      <div class="node-detail">
        Vector search using enriched query<br>
        <strong>Result:</strong> Contextual discussions about identified entities
      </div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <div class="node node-decision">
      <div class="node-label orange">VISUALIZATION CHECK</div>
      <div class="node-title">Should create visualization?</div>
      <div class="node-detail">Check if SQL results are suitable for charting</div>
    </div>

    <div class="arrow">
      <div class="arrow-line"></div>
      <div class="arrow-label yes">YES</div>
      <div class="arrow-head"></div>
    </div>

    <div class="node node-tool">
      <div class="node-label pink">TOOL 3 ‚Äî VISUALIZATION</div>
      <div class="node-title">create_visualization(sql_results)</div>
      <div class="node-detail">Generate chart for statistical data</div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <div class="node node-output">
      <div class="node-label green">RESPONSE</div>
      <div class="node-title">Hybrid Response</div>
      <div class="node-detail">
        <strong>Contains:</strong><br>
        ‚Ä¢ Comprehensive answer (stats + context)<br>
        ‚Ä¢ SQL results<br>
        ‚Ä¢ Vector search sources<br>
        ‚Ä¢ Visualization (if created)<br><br>
        <strong>Response Time:</strong> 4-7 seconds
      </div>
    </div>
  </div>

  <h3 class="section-subtitle">Entity Extraction & Query Enrichment</h3>

  <div class="info-grid">
    <div class="info-box">
      <h4>üéØ Entity Extraction Fields</h4>
      <ul>
        <li><code>name</code> ‚Äî Player name</li>
        <li><code>player_name</code> ‚Äî Alternate player field</li>
        <li><code>team_name</code> ‚Äî Team name</li>
        <li><code>team</code> ‚Äî Alternate team field</li>
        <li><code>player</code> ‚Äî Generic player field</li>
      </ul>
      <strong>Process:</strong> Scan SQL results, extract values, remove duplicates
    </div>

    <div class="info-box">
      <h4>‚ú® Query Enrichment Examples</h4>
      <ul>
        <li><strong>Input:</strong> "Why is he great?"<br>
            <strong>Entities:</strong> ["Nikola Jokiƒá"]<br>
            <strong>Output:</strong> "Nikola Jokiƒá MVP impact playing style"</li>
        <li><strong>Input:</strong> "What makes them effective?"<br>
            <strong>Entities:</strong> ["Warriors"]<br>
            <strong>Output:</strong> "Warriors effective team strategy offense"</li>
      </ul>
    </div>

    <div class="info-box">
      <h4>‚öôÔ∏è Enrichment Rules</h4>
      <ul>
        <li>Replace pronouns: he/him/they ‚Üí entity names</li>
        <li>Remove question words: why/how/what</li>
        <li>Extract key nouns and adjectives</li>
        <li>Add context keywords: MVP, style, impact, great</li>
        <li>Limit to reasonable length (~100 chars)</li>
      </ul>
    </div>
  </div>

  <h3 class="section-subtitle">Complete Hybrid Flow Example</h3>

  <div class="code-block">
    <code><strong>User Query:</strong> "Who is Nikola Jokiƒá and why is he considered great?"

<strong>Step 1: SQL Query</strong>
Generated SQL:
SELECT p.*, ps.pts, ps.reb, ps.ast, ps.fg_pct
FROM players p
JOIN player_stats ps ON p.id = ps.player_id
WHERE p.name LIKE '%Jokiƒá%'

Results:
{
  "name": "Nikola Jokiƒá",
  "age": 28,
  "height": 211,
  "weight": 130,
  "pts": 2074,
  "reb": 942,
  "ast": 654,
  ...
}

<strong>Step 2: Entity Extraction</strong>
Extracted entities: ["Nikola Jokiƒá"]

<strong>Step 3: Query Enrichment</strong>
Original: "Why is he considered great?"
Enriched: "Nikola Jokiƒá MVP impact playing style great player center"

<strong>Step 4: Vector Search</strong>
Search with enriched query, k=5
Results: 5 Reddit discussions about Jokiƒá's greatness, MVP wins, unique playstyle

<strong>Step 5: Visualization</strong>
Create bar chart: Jokiƒá's PPG/RPG/APG stats

<strong>Final Answer:</strong>
"Nikola Jokiƒá is a 28-year-old center from Serbia who plays for the Denver Nuggets.

**Statistics (This Season):**
- Points: 29.6 PPG
- Rebounds: 13.4 RPG
- Assists: 9.3 APG
- Field Goal %: 58.3%

**Why He's Considered Great:**
Based on fan discussions and analysis:

1. **Unique Playing Style**: Jokiƒá has revolutionized the center position with his exceptional passing ability and court vision, averaging nearly 10 assists per game‚Äîunprecedented for a big man.

2. **MVP Performance**: He's won back-to-back MVP awards (2021, 2022) and led the Nuggets to their first NBA championship in 2023.

3. **Efficiency**: His shooting touch and basketball IQ make him one of the most efficient scorers in the league, with elite FG% for a center.

4. **All-Around Impact**: Unlike traditional centers, Jokiƒá impacts every facet of the game‚Äîscoring, rebounding, playmaking, and even defense.

Fans describe him as having 'the best passing for a big man in NBA history' and praise his ability to make teammates better through his unselfish play.

[Visualization: Bar chart showing PPG, RPG, APG]

**Sources:**
- [Jokiƒá MVP Discussion Thread](https://reddit.com/r/nba/...)
- [Why Jokiƒá is Revolutionizing the Center Position](https://reddit.com/r/nba/...)"</code>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB 6: TOOL DETAILS
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="panel-tools" class="panel">
  <h2 class="section-title">üõ†Ô∏è Tool Specifications</h2>

  <div class="info-grid">
    <div class="info-box">
      <h4>üîµ query_nba_database</h4>
      <strong>Purpose:</strong> Query NBA statistics database<br><br>
      <strong>Technology:</strong>
      <ul>
        <li>LangChain SQL Agent</li>
        <li>PostgreSQL database</li>
        <li>Natural language ‚Üí SQL conversion</li>
      </ul>
      <strong>Input:</strong><br>
      <code>question: str</code> ‚Äî Natural language question<br><br>
      <strong>Output:</strong>
      <ul>
        <li><code>sql</code> ‚Äî Generated SQL query</li>
        <li><code>results</code> ‚Äî Query results (list of dicts)</li>
        <li><code>answer</code> ‚Äî Formatted answer text</li>
        <li><code>error</code> ‚Äî Error message (if any)</li>
        <li><code>row_count</code> ‚Äî Number of rows returned</li>
        <li><code>agent_steps</code> ‚Äî Reasoning steps taken</li>
      </ul>
      <strong>Success Rate:</strong> 87%<br>
      <strong>Avg Execution Time:</strong> 1.5-3s
    </div>

    <div class="info-box">
      <h4>üü£ search_knowledge_base</h4>
      <strong>Purpose:</strong> Search NBA knowledge base for opinions/context<br><br>
      <strong>Technology:</strong>
      <ul>
        <li>FAISS vector store</li>
        <li>Google text-embedding-004</li>
        <li>IndexFlatIP for exact search</li>
      </ul>
      <strong>Input:</strong><br>
      <code>query: str</code> ‚Äî Search query<br>
      <code>k: int = 5</code> ‚Äî Number of results<br><br>
      <strong>Output:</strong>
      <ul>
        <li><code>results</code> ‚Äî Top-k search results with content + metadata</li>
        <li><code>sources</code> ‚Äî List of source URLs</li>
        <li><code>count</code> ‚Äî Number of results returned</li>
      </ul>
      <strong>Corpus:</strong> ~10k Reddit discussions from r/nba<br>
      <strong>Relevance Rate:</strong> 95%<br>
      <strong>Avg Execution Time:</strong> 200-300ms
    </div>

    <div class="info-box">
      <h4>üìä create_visualization</h4>
      <strong>Purpose:</strong> Auto-generate charts for SQL results<br><br>
      <strong>Technology:</strong>
      <ul>
        <li>Altair (Vega-Lite)</li>
        <li>LLM-assisted chart suggestion</li>
      </ul>
      <strong>Chart Types:</strong>
      <ul>
        <li>Bar charts (categorical + numeric)</li>
        <li>Line charts (time series)</li>
        <li>Scatter plots (correlations)</li>
        <li>Grouped bar charts (comparisons)</li>
      </ul>
      <strong>Input:</strong><br>
      <code>sql_results: list[dict]</code> ‚Äî SQL query results<br>
      <code>question: str</code> ‚Äî Original question for context<br><br>
      <strong>Output:</strong>
      <ul>
        <li><code>type</code> ‚Äî Chart type</li>
        <li><code>spec</code> ‚Äî Vega-Lite specification (JSON)</li>
        <li><code>title</code> ‚Äî Chart title</li>
        <li><code>description</code> ‚Äî Accessibility description</li>
      </ul>
      <strong>Creation Rate:</strong> 78% (for suitable queries)<br>
      <strong>Avg Execution Time:</strong> 300-500ms
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB 7: DATA PIPELINE
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="panel-data" class="panel">
  <h2 class="section-title">üóÑÔ∏è Data Pipeline ‚Äî Data Ingestion & Storage</h2>

  <h3 class="section-subtitle">High-Level Overview</h3>

  <div style="background: var(--card); border: 2px solid var(--border); border-radius: 12px; padding: 24px; margin: 20px auto; max-width: 900px;">
    <div style="display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap; gap: 20px;">
      <div style="text-align: center; flex: 1; min-width: 200px;">
        <div style="font-size: 3rem; margin-bottom: 8px;">üì•</div>
        <div style="font-weight: 600; color: var(--accent-blue); margin-bottom: 4px;">SOURCES</div>
        <div style="font-size: 0.85rem; color: var(--muted);">NBA API<br>Reddit r/nba</div>
      </div>
      <div style="font-size: 2rem; color: var(--border);">‚Üí</div>
      <div style="text-align: center; flex: 1; min-width: 200px;">
        <div style="font-size: 3rem; margin-bottom: 8px;">üîÑ</div>
        <div style="font-weight: 600; color: var(--accent-orange); margin-bottom: 4px;">TRANSFORM</div>
        <div style="font-size: 0.85rem; color: var(--muted);">Clean & Validate<br>Chunk & Process</div>
      </div>
      <div style="font-size: 2rem; color: var(--border);">‚Üí</div>
      <div style="text-align: center; flex: 1; min-width: 200px;">
        <div style="font-size: 3rem; margin-bottom: 8px;">üíæ</div>
        <div style="font-weight: 600; color: var(--accent-teal); margin-bottom: 4px;">STORAGE</div>
        <div style="font-size: 0.85rem; color: var(--muted);">PostgreSQL<br>FAISS</div>
      </div>
      <div style="font-size: 2rem; color: var(--border);">‚Üí</div>
      <div style="text-align: center; flex: 1; min-width: 200px;">
        <div style="font-size: 3rem; margin-bottom: 8px;">‚úÖ</div>
        <div style="font-weight: 600; color: var(--accent-green); margin-bottom: 4px;">READY</div>
        <div style="font-size: 0.85rem; color: var(--muted);">Query Pipeline<br>ReAct Agent</div>
      </div>
    </div>
  </div>

  <h3 class="section-subtitle">Detailed Flow</h3>

  <div class="flow">
    <!-- Data Sources -->
    <div class="node node-start">
      <div class="node-label blue">DATA SOURCES</div>
      <div class="node-title">External Data Sources</div>
      <div class="node-detail">
        <strong>1. NBA Statistics:</strong> Official NBA stats API, player data, team standings<br>
        <strong>2. Reddit Discussions:</strong> r/nba subreddit posts, comments, analysis
      </div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <!-- Data Ingestion -->
    <div class="node node-process">
      <div class="node-label blue">DATA INGESTION</div>
      <div class="node-title">Fetch & Clean Raw Data</div>
      <div class="node-detail">
        <strong>NBA Stats:</strong> Fetch via API, parse JSON, normalize (~450 players, 30 teams)<br>
        <strong>Reddit:</strong> Scrape r/nba, filter quality posts (~10K discussions)
      </div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <!-- Data Transformation -->
    <div class="node node-process">
      <div class="node-label blue">DATA TRANSFORMATION</div>
      <div class="node-title">Transform & Validate</div>
      <div class="node-detail">
        <strong>NBA:</strong> Calculate PPG/RPG/APG, validate ranges, create mappings<br>
        <strong>Reddit:</strong> Clean text, chunk (1000 tok, 200 overlap) ‚Üí ~15K chunks
      </div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <!-- Branch: SQL vs Vector -->
    <div class="branch">
      <!-- SQL Database Path -->
      <div class="branch-path">
        <div class="branch-label sql">SQL DATABASE (PostgreSQL)</div>

        <div class="node node-sql" style="min-width: 320px;">
          <div class="node-label blue">STRUCTURED DATA</div>
          <div class="node-title">PostgreSQL Database</div>
          <div class="node-detail">
            <strong>Tables:</strong> players, teams, player_stats<br>
            <strong>Process:</strong> Upsert records, create indexes<br>
            <strong>Result:</strong> ~50 MB database, query time &lt;100ms
          </div>
        </div>
      </div>

      <!-- Vector Store Path -->
      <div class="branch-path">
        <div class="branch-label vector">VECTOR STORE (FAISS)</div>

        <div class="node node-vector" style="min-width: 320px;">
          <div class="node-label purple">UNSTRUCTURED DATA</div>
          <div class="node-title">FAISS Vector Store</div>
          <div class="node-detail">
            <strong>Embeddings:</strong> Google text-embedding-004 (768-dim)<br>
            <strong>Process:</strong> Batch generate, build IndexFlatIP index<br>
            <strong>Result:</strong> ~50-100 MB, 15K chunks, search &lt;100ms
          </div>
        </div>
      </div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <!-- Data Validation -->
    <div class="node node-decision">
      <div class="node-label orange">VALIDATION</div>
      <div class="node-title">Quality Checks</div>
      <div class="node-detail">
        <strong>SQL:</strong> Row counts, NULL checks, FK integrity, stat ranges<br>
        <strong>Vector:</strong> Embedding coverage, collection size, sample searches
      </div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <!-- Ready for Production -->
    <div class="node node-output">
      <div class="node-label green">READY</div>
      <div class="node-title">Pipeline Complete ‚úÖ</div>
      <div class="node-detail">
        PostgreSQL + FAISS populated ‚Ä¢ System ready to serve queries
      </div>
    </div>
  </div>

  <h3 class="section-subtitle">Storage Systems Comparison</h3>

  <table class="example-table" style="margin-bottom: 30px;">
    <thead>
      <tr>
        <th>Feature</th>
        <th><span class="tag-sql">PostgreSQL</span></th>
        <th><span class="tag-vector">FAISS</span></th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Data Type</strong></td>
        <td>Structured (tables, rows)</td>
        <td>Unstructured (text, embeddings)</td>
      </tr>
      <tr>
        <td><strong>Use Case</strong></td>
        <td>Statistical queries (PPG, rankings)</td>
        <td>Semantic search (opinions, context)</td>
      </tr>
      <tr>
        <td><strong>Storage Size</strong></td>
        <td>~50 MB</td>
        <td>~50-100 MB</td>
      </tr>
      <tr>
        <td><strong>Record Count</strong></td>
        <td>450+ players, 30 teams, 450+ stats</td>
        <td>15,000 text chunks</td>
      </tr>
      <tr>
        <td><strong>Query Method</strong></td>
        <td>SQL queries (exact matching)</td>
        <td>Vector similarity (semantic)</td>
      </tr>
      <tr>
        <td><strong>Query Speed</strong></td>
        <td>&lt;100ms</td>
        <td>50-100ms</td>
      </tr>
      <tr>
        <td><strong>Index Type</strong></td>
        <td>B-tree indexes on key columns</td>
        <td>IndexFlatIP (exact search)</td>
      </tr>
      <tr>
        <td><strong>Example Query</strong></td>
        <td>"Top 5 scorers this season"</td>
        <td>"Why is LeBron considered great?"</td>
      </tr>
    </tbody>
  </table>

  <h3 class="section-subtitle">Storage Architecture Details</h3>

  <div class="info-grid">
    <div class="info-box">
      <h4>üîµ PostgreSQL Database</h4>
      <strong>Location:</strong> <code>data/sql/nba_stats.db</code><br>
      <strong>Size:</strong> ~50 MB<br><br>
      <strong>Tables:</strong>
      <ul>
        <li><strong>players</strong> (450+ rows): id, name, age, height, weight, team_id</li>
        <li><strong>teams</strong> (30 rows): id, name, city, conference, division</li>
        <li><strong>player_stats</strong> (450+ rows): player_id, gp, pts, reb, ast, fg%, 3p%, ft%, stl, blk</li>
      </ul>
      <strong>Indexes:</strong>
      <ul>
        <li>Primary keys: players.id, teams.id</li>
        <li>Foreign keys: player_stats.player_id ‚Üí players.id</li>
        <li>Search indexes: players.name, teams.name</li>
        <li>Stats indexes: player_stats.pts, player_stats.reb</li>
      </ul>
    </div>

    <div class="info-box">
      <h4>üü£ FAISS Vector Store</h4>
      <strong>Location:</strong> <code>data/vector/faiss_vector/</code><br>
      <strong>Size:</strong> ~50-100 MB<br><br>
      <strong>Collection:</strong> <code>faiss_index</code>
      <ul>
        <li><strong>Documents:</strong> ~15,000 text chunks</li>
        <li><strong>Embeddings:</strong> 768 dimensions per chunk</li>
        <li><strong>Metadata:</strong> source, title, url, timestamp, score</li>
      </ul>
      <strong>Index:</strong> IndexFlatIP (exact cosine similarity)
      <ul>
        <li>Algorithm: Brute-force exact search (not approximate)</li>
        <li>Similarity: Inner Product after L2 normalization</li>
        <li>100% recall accuracy (exact nearest neighbors)</li>
      </ul>
    </div>

    <div class="info-box">
      <h4>üìÅ Data Directory Structure</h4>
      <div class="code-block">
        <code>data/
‚îú‚îÄ‚îÄ sql/
‚îÇ   ‚îî‚îÄ‚îÄ nba_stats.db              # PostgreSQL database
‚îú‚îÄ‚îÄ vector/
‚îÇ   ‚îú‚îÄ‚îÄ faiss_index.idx           # FAISS vector index
‚îÇ   ‚îî‚îÄ‚îÄ document_chunks.pkl       # Document chunks with metadata
‚îú‚îÄ‚îÄ inputs/                        # Raw data sources (gitignored)
‚îÇ   ‚îú‚îÄ‚îÄ nba_stats_raw.json
‚îÇ   ‚îî‚îÄ‚îÄ reddit_posts.json
‚îî‚îÄ‚îÄ reference/                     # Reference data, schemas
    ‚îî‚îÄ‚îÄ database_schema.sql</code>
      </div>
    </div>
  </div>

  <h3 class="section-subtitle">Data Refresh & Update Process</h3>

  <div class="flow">
    <div class="node node-start">
      <div class="node-label blue">SCHEDULED UPDATE</div>
      <div class="node-title">Trigger Data Refresh</div>
      <div class="node-detail">
        <strong>Frequency:</strong> Weekly (or on-demand)<br>
        <strong>Trigger:</strong> Cron job or manual script execution
      </div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <div class="node node-process">
      <div class="node-label blue">INCREMENTAL UPDATE</div>
      <div class="node-title">Fetch Only New/Changed Data</div>
      <div class="node-detail">
        <strong>NBA Stats:</strong>
        <ul>
          <li>Fetch latest stats since last update</li>
          <li>Upsert player stats (update if exists, insert if new)</li>
          <li>Add new players/teams as needed</li>
        </ul>
        <strong>Reddit Data:</strong>
        <ul>
          <li>Fetch new posts since last update timestamp</li>
          <li>Filter and process new discussions</li>
          <li>Generate embeddings for new chunks</li>
        </ul>
      </div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <div class="node node-process">
      <div class="node-label blue">UPDATE STORAGE</div>
      <div class="node-title">Update Databases</div>
      <div class="node-detail">
        <strong>PostgreSQL:</strong> Execute UPDATE/INSERT statements<br>
        <strong>FAISS:</strong> Add new documents to collection<br>
        <strong>Indexes:</strong> Auto-updated by database systems
      </div>
    </div>

    <div class="arrow"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <div class="node node-output">
      <div class="node-label green">COMPLETE</div>
      <div class="node-title">Data Refreshed</div>
      <div class="node-detail">
        System now serves queries with latest data<br>
        No downtime required (hot updates)
      </div>
    </div>
  </div>

  <h3 class="section-subtitle">Data Pipeline Scripts</h3>

  <div class="info-grid">
    <div class="info-box">
      <h4>üìú Available Scripts</h4>
      <ul>
        <li><code>scripts/data/ingest_nba_stats.py</code> ‚Äî Fetch and populate NBA stats</li>
        <li><code>scripts/data/ingest_reddit.py</code> ‚Äî Scrape and process Reddit data</li>
        <li><code>scripts/data/generate_embeddings.py</code> ‚Äî Generate embeddings for text chunks</li>
        <li><code>scripts/data/populate_vector_store.py</code> ‚Äî Create FAISS collection</li>
        <li><code>scripts/data/validate_data.py</code> ‚Äî Validate data quality and integrity</li>
        <li><code>scripts/data/refresh_all.py</code> ‚Äî Run full data refresh pipeline</li>
      </ul>
    </div>

    <div class="info-box">
      <h4>üîÑ Refresh Workflow</h4>
      <div class="code-block">
        <code><strong># Full refresh (wipe and rebuild)</strong>
python scripts/data/refresh_all.py --mode=full

<strong># Incremental update (new data only)</strong>
python scripts/data/refresh_all.py --mode=incremental

<strong># Validate existing data</strong>
python scripts/data/validate_data.py --verbose</code>
      </div>
    </div>

    <div class="info-box">
      <h4>‚öôÔ∏è Configuration</h4>
      <strong>Environment Variables:</strong>
      <ul>
        <li><code>NBA_API_KEY</code> ‚Äî NBA stats API key (optional)</li>
        <li><code>REDDIT_CLIENT_ID</code> ‚Äî Reddit API client ID</li>
        <li><code>REDDIT_CLIENT_SECRET</code> ‚Äî Reddit API secret</li>
        <li><code>GOOGLE_API_KEY</code> ‚Äî Google Gemini API key (for embeddings)</li>
      </ul>
      <strong>Configs:</strong>
      <ul>
        <li><code>src/core/config.py</code> ‚Äî Database paths, collection names</li>
        <li><code>pyproject.toml</code> ‚Äî Dependencies (chromadb, psycopg2, praw)</li>
      </ul>
    </div>
  </div>

  <h3 class="section-subtitle">Data Quality Metrics</h3>

  <div class="info-grid">
    <div class="info-box">
      <h4>üìä SQL Database Stats</h4>
      <div class="metric">
        <span class="metric-label">Total Players</span>
        <span class="metric-value">450+</span>
      </div>
      <div class="metric">
        <span class="metric-label">Total Teams</span>
        <span class="metric-value">30</span>
      </div>
      <div class="metric">
        <span class="metric-label">Data Completeness</span>
        <span class="metric-value">98%</span>
      </div>
      <div class="metric">
        <span class="metric-label">Last Updated</span>
        <span class="metric-value">2026-02-15</span>
      </div>
    </div>

    <div class="info-box">
      <h4>üìö Vector Store Stats</h4>
      <div class="metric">
        <span class="metric-label">Reddit Discussions</span>
        <span class="metric-value">~10,000</span>
      </div>
      <div class="metric">
        <span class="metric-label">Text Chunks</span>
        <span class="metric-value">~15,000</span>
      </div>
      <div class="metric">
        <span class="metric-label">Embedding Coverage</span>
        <span class="metric-value">100%</span>
      </div>
      <div class="metric">
        <span class="metric-label">Avg Chunk Size</span>
        <span class="metric-value">800 tokens</span>
      </div>
    </div>

    <div class="info-box">
      <h4>‚ö° Performance Metrics</h4>
      <div class="metric">
        <span class="metric-label">Full Refresh Time</span>
        <span class="metric-value">~15 min</span>
      </div>
      <div class="metric">
        <span class="metric-label">Incremental Update</span>
        <span class="metric-value">~2 min</span>
      </div>
      <div class="metric">
        <span class="metric-label">SQL Query Time</span>
        <span class="metric-value">&lt;100ms</span>
      </div>
      <div class="metric">
        <span class="metric-label">Vector Search Time</span>
        <span class="metric-value">50-100ms</span>
      </div>
    </div>
  </div>

  <h3 class="section-subtitle">Visual Data Pipeline Diagram</h3>

  <div style="background: linear-gradient(135deg, #161b22 0%, #0d1117 100%); border: 2px solid var(--border); border-radius: 12px; padding: 32px; margin: 20px auto; max-width: 1000px;">

    <!-- Sources -->
    <div style="display: flex; gap: 40px; justify-content: center; margin-bottom: 30px;">
      <div style="background: rgba(88,166,255,0.1); border: 2px solid var(--accent-blue); border-radius: 8px; padding: 20px; flex: 1; max-width: 300px;">
        <div style="font-size: 2rem; text-align: center; margin-bottom: 10px;">üìä</div>
        <div style="font-weight: 600; color: var(--accent-blue); text-align: center; margin-bottom: 10px;">NBA Stats API</div>
        <div style="font-size: 0.8rem; color: var(--text);">
          ‚Ä¢ Player profiles (450+)<br>
          ‚Ä¢ Season statistics<br>
          ‚Ä¢ Team standings<br>
          ‚Ä¢ Game results
        </div>
      </div>
      <div style="background: rgba(188,140,255,0.1); border: 2px solid var(--accent-purple); border-radius: 8px; padding: 20px; flex: 1; max-width: 300px;">
        <div style="font-size: 2rem; text-align: center; margin-bottom: 10px;">üí¨</div>
        <div style="font-weight: 600; color: var(--accent-purple); text-align: center; margin-bottom: 10px;">Reddit r/nba</div>
        <div style="font-size: 0.8rem; color: var(--text);">
          ‚Ä¢ Discussions & debates<br>
          ‚Ä¢ Player analysis<br>
          ‚Ä¢ Game threads<br>
          ‚Ä¢ Fan opinions (~10K posts)
        </div>
      </div>
    </div>

    <!-- Arrow Down -->
    <div style="text-align: center; margin: 20px 0; font-size: 2rem; color: var(--border);">‚Üì</div>

    <!-- Processing -->
    <div style="background: rgba(210,153,34,0.1); border: 2px dashed var(--accent-orange); border-radius: 8px; padding: 20px; margin: 20px auto; max-width: 700px;">
      <div style="font-weight: 600; color: var(--accent-orange); text-align: center; margin-bottom: 15px; font-size: 1.1rem;">üîÑ DATA PROCESSING</div>
      <div style="display: flex; gap: 20px; justify-content: space-around;">
        <div style="flex: 1;">
          <div style="color: var(--heading); font-weight: 600; margin-bottom: 5px;">1. Fetch & Clean</div>
          <div style="font-size: 0.8rem; color: var(--muted);">
            ‚Ä¢ API calls<br>
            ‚Ä¢ Parse JSON<br>
            ‚Ä¢ Remove duplicates
          </div>
        </div>
        <div style="flex: 1;">
          <div style="color: var(--heading); font-weight: 600; margin-bottom: 5px;">2. Transform</div>
          <div style="font-size: 0.8rem; color: var(--muted);">
            ‚Ä¢ Calculate metrics<br>
            ‚Ä¢ Normalize data<br>
            ‚Ä¢ Chunk text (1000 tok)
          </div>
        </div>
        <div style="flex: 1;">
          <div style="color: var(--heading); font-weight: 600; margin-bottom: 5px;">3. Validate</div>
          <div style="font-size: 0.8rem; color: var(--muted);">
            ‚Ä¢ Check integrity<br>
            ‚Ä¢ Verify ranges<br>
            ‚Ä¢ Flag errors
          </div>
        </div>
      </div>
    </div>

    <!-- Arrow Down -->
    <div style="text-align: center; margin: 20px 0; font-size: 2rem; color: var(--border);">‚Üì</div>

    <!-- Storage Layer -->
    <div style="display: flex; gap: 40px; justify-content: center; margin-bottom: 30px;">
      <div style="background: rgba(88,166,255,0.15); border: 2px solid var(--accent-blue); border-radius: 8px; padding: 20px; flex: 1; max-width: 350px;">
        <div style="font-size: 2rem; text-align: center; margin-bottom: 10px;">üîµ</div>
        <div style="font-weight: 600; color: var(--accent-blue); text-align: center; margin-bottom: 10px;">PostgreSQL Database</div>
        <div style="font-size: 0.8rem; color: var(--text); margin-bottom: 10px;">
          <strong>Tables:</strong><br>
          ‚Ä¢ players (450+ rows)<br>
          ‚Ä¢ teams (30 rows)<br>
          ‚Ä¢ player_stats (450+ rows)
        </div>
        <div style="font-size: 0.8rem; color: var(--text);">
          <strong>Indexes:</strong><br>
          ‚Ä¢ players.name<br>
          ‚Ä¢ player_stats.pts, reb, ast<br>
          ‚Ä¢ teams.name
        </div>
        <div style="text-align: center; margin-top: 10px; padding: 6px; background: rgba(63,185,80,0.1); border-radius: 4px;">
          <span style="color: var(--accent-green); font-size: 0.75rem; font-weight: 600;">‚ö° Query time: &lt;100ms</span>
        </div>
      </div>

      <div style="background: rgba(188,140,255,0.15); border: 2px solid var(--accent-purple); border-radius: 8px; padding: 20px; flex: 1; max-width: 350px;">
        <div style="font-size: 2rem; text-align: center; margin-bottom: 10px;">üü£</div>
        <div style="font-weight: 600; color: var(--accent-purple); text-align: center; margin-bottom: 10px;">FAISS Vector Store</div>
        <div style="font-size: 0.8rem; color: var(--text); margin-bottom: 10px;">
          <strong>Collection:</strong> faiss_index<br>
          ‚Ä¢ 15K text chunks<br>
          ‚Ä¢ 768-dim embeddings<br>
          ‚Ä¢ Google text-embedding-004
        </div>
        <div style="font-size: 0.8rem; color: var(--text);">
          <strong>Index:</strong> IndexFlatIP (exact search)<br>
          ‚Ä¢ Fast similarity search<br>
          ‚Ä¢ Approximate k-NN
        </div>
        <div style="text-align: center; margin-top: 10px; padding: 6px; background: rgba(63,185,80,0.1); border-radius: 4px;">
          <span style="color: var(--accent-green); font-size: 0.75rem; font-weight: 600;">‚ö° Search time: 50-100ms</span>
        </div>
      </div>
    </div>

    <!-- Arrow Down -->
    <div style="text-align: center; margin: 20px 0; font-size: 2rem; color: var(--border);">‚Üì</div>

    <!-- Ready State -->
    <div style="background: rgba(63,185,80,0.15); border: 2px solid var(--accent-green); border-radius: 8px; padding: 20px; margin: 20px auto; max-width: 500px; text-align: center;">
      <div style="font-size: 2rem; margin-bottom: 10px;">‚úÖ</div>
      <div style="font-weight: 600; color: var(--accent-green); margin-bottom: 10px; font-size: 1.2rem;">READY FOR QUERIES</div>
      <div style="font-size: 0.85rem; color: var(--text);">
        Data pipeline complete<br>
        ReAct Agent can now serve user queries<br>
        <span style="color: var(--accent-green);">No downtime ‚Ä¢ Hot updates supported</span>
      </div>
    </div>
  </div>

  <h3 class="section-subtitle">Data Flow Summary</h3>

  <div class="info-grid">
    <div class="info-box">
      <h4>üì• Step 1: Data Ingestion</h4>
      <strong>Duration:</strong> 5-10 minutes<br><br>
      <strong>NBA Stats:</strong>
      <ul>
        <li>Fetch from NBA Stats API</li>
        <li>Parse player profiles, stats, teams</li>
        <li>~450 players, 30 teams</li>
      </ul>
      <strong>Reddit:</strong>
      <ul>
        <li>Scrape r/nba using PRAW</li>
        <li>Filter quality (upvotes, comments)</li>
        <li>~10,000 discussions collected</li>
      </ul>
    </div>

    <div class="info-box">
      <h4>üîÑ Step 2: Transformation</h4>
      <strong>Duration:</strong> 3-5 minutes<br><br>
      <strong>NBA Stats:</strong>
      <ul>
        <li>Calculate PPG, RPG, APG</li>
        <li>Validate ranges & integrity</li>
        <li>Create player ‚Üî team mappings</li>
      </ul>
      <strong>Reddit:</strong>
      <ul>
        <li>Clean text (URLs, special chars)</li>
        <li>Chunk into 1000 tokens (200 overlap)</li>
        <li>~15,000 chunks created</li>
      </ul>
    </div>

    <div class="info-box">
      <h4>üíæ Step 3: Storage</h4>
      <strong>Duration:</strong> 5-8 minutes<br><br>
      <strong>PostgreSQL:</strong>
      <ul>
        <li>Insert/update tables</li>
        <li>Create indexes for fast queries</li>
        <li>~50 MB database size</li>
      </ul>
      <strong>FAISS:</strong>
      <ul>
        <li>Generate embeddings (batch 100)</li>
        <li>Build IndexFlatIP index</li>
        <li>~50-100 MB vector store size</li>
      </ul>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB 8: EXAMPLES & METRICS
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="panel-examples" class="panel">
  <h2 class="section-title">üìä Query Examples & Performance Metrics</h2>

  <h3 class="section-subtitle">Example Queries by Type</h3>

  <table class="example-table">
    <thead>
      <tr>
        <th style="width: 40%;">Query</th>
        <th>Type</th>
        <th>Tools Used</th>
        <th>Response Time</th>
        <th>Visualization</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>"Who scored the most points this season?"</td>
        <td><span class="tag-sql">sql_only</span></td>
        <td>SQL</td>
        <td>2.3s</td>
        <td>‚úÖ Bar chart</td>
      </tr>
      <tr>
        <td>"Top 5 rebounders"</td>
        <td><span class="tag-sql">sql_only</span></td>
        <td>SQL</td>
        <td>2.1s</td>
        <td>‚úÖ Bar chart</td>
      </tr>
      <tr>
        <td>"Compare Jokiƒá and Embiid stats"</td>
        <td><span class="tag-sql">sql_only</span></td>
        <td>SQL</td>
        <td>2.8s</td>
        <td>‚úÖ Grouped bar</td>
      </tr>
      <tr>
        <td>"Average PPG for Lakers players"</td>
        <td><span class="tag-sql">sql_only</span></td>
        <td>SQL</td>
        <td>2.5s</td>
        <td>‚úÖ Bar chart</td>
      </tr>
      <tr>
        <td>"Why is LeBron considered one of the greatest?"</td>
        <td><span class="tag-vector">vector_only</span></td>
        <td>Vector</td>
        <td>1.4s <span class="tag-fast">FAST</span></td>
        <td>‚ùå</td>
      </tr>
      <tr>
        <td>"What do fans think about the Lakers?"</td>
        <td><span class="tag-vector">vector_only</span></td>
        <td>Vector</td>
        <td>1.3s <span class="tag-fast">FAST</span></td>
        <td>‚ùå</td>
      </tr>
      <tr>
        <td>"How does Curry's shooting style work?"</td>
        <td><span class="tag-vector">vector_only</span></td>
        <td>Vector</td>
        <td>1.5s <span class="tag-fast">FAST</span></td>
        <td>‚ùå</td>
      </tr>
      <tr>
        <td>"What are the debates around MVP voting?"</td>
        <td><span class="tag-vector">vector_only</span></td>
        <td>Vector</td>
        <td>1.6s <span class="tag-fast">FAST</span></td>
        <td>‚ùå</td>
      </tr>
      <tr>
        <td>"Who is Nikola Jokiƒá and why is he great?"</td>
        <td><span class="tag-hybrid">hybrid</span></td>
        <td>SQL + Vector</td>
        <td>5.2s</td>
        <td>‚úÖ Bar chart</td>
      </tr>
      <tr>
        <td>"Tell me about Giannis Antetokounmpo"</td>
        <td><span class="tag-hybrid">hybrid</span></td>
        <td>SQL + Vector</td>
        <td>4.9s</td>
        <td>‚úÖ Bar chart</td>
      </tr>
      <tr>
        <td>"Top scorers and what makes them effective"</td>
        <td><span class="tag-hybrid">hybrid</span></td>
        <td>SQL + Vector</td>
        <td>6.1s</td>
        <td>‚úÖ Bar chart</td>
      </tr>
      <tr>
        <td>"Compare LeBron and Durant's careers"</td>
        <td><span class="tag-hybrid">hybrid</span></td>
        <td>SQL + Vector</td>
        <td>5.8s</td>
        <td>‚úÖ Grouped bar</td>
      </tr>
    </tbody>
  </table>

  <h3 class="section-subtitle">Performance Metrics</h3>

  <div class="info-grid">
    <div class="info-box">
      <h4>üéØ Classification Accuracy</h4>
      <div class="metric">
        <span class="metric-label">Heuristic Accuracy (70% coverage)</span>
        <span class="metric-value">92%</span>
      </div>
      <div class="metric">
        <span class="metric-label">LLM Accuracy (30% coverage)</span>
        <span class="metric-value">98%</span>
      </div>
      <div class="metric">
        <span class="metric-label">Combined Overall Accuracy</span>
        <span class="metric-value">94%</span>
      </div>
      <div class="metric">
        <span class="metric-label">Misclassification Rate</span>
        <span class="metric-value">6%</span>
      </div>
    </div>

    <div class="info-box">
      <h4>‚ö° Response Times (Average)</h4>
      <div class="metric">
        <span class="metric-label">SQL-Only Queries</span>
        <span class="metric-value">2-4s</span>
      </div>
      <div class="metric">
        <span class="metric-label">Vector-Only Queries</span>
        <span class="metric-value">1-2s</span>
      </div>
      <div class="metric">
        <span class="metric-label">Hybrid Queries</span>
        <span class="metric-value">4-7s</span>
      </div>
      <div class="metric">
        <span class="metric-label">Greetings (Early Return)</span>
        <span class="metric-value">&lt;500ms</span>
      </div>
    </div>

    <div class="info-box">
      <h4>‚úÖ Success Rates</h4>
      <div class="metric">
        <span class="metric-label">SQL Query Generation</span>
        <span class="metric-value">87%</span>
      </div>
      <div class="metric">
        <span class="metric-label">Vector Search Relevance</span>
        <span class="metric-value">95%</span>
      </div>
      <div class="metric">
        <span class="metric-label">Auto-Visualization Creation</span>
        <span class="metric-value">78%</span>
      </div>
      <div class="metric">
        <span class="metric-label">Overall Query Success</span>
        <span class="metric-value">91%</span>
      </div>
    </div>
  </div>

  <h3 class="section-subtitle">Cost & Efficiency Savings</h3>

  <div class="info-grid">
    <div class="info-box">
      <h4>üí∞ Cost Optimization (vs. Always Using LLM)</h4>
      <ul>
        <li><strong>Heuristic Classification:</strong> 70% of queries classified without LLM call</li>
        <li><strong>Cost Savings:</strong> ~70% reduction in classification API calls</li>
        <li><strong>Time Savings:</strong> ~200-300ms faster per heuristic classification</li>
        <li><strong>Prompt Caching:</strong> Reduces LLM classification token costs by ~40%</li>
      </ul>
    </div>

    <div class="info-box">
      <h4>üöÄ Performance Optimizations</h4>
      <ul>
        <li><strong>Lazy Initialization:</strong> Heavy modules loaded on first use only</li>
        <li><strong>Early Returns:</strong> Greetings bypass entire pipeline (&lt;500ms)</li>
        <li><strong>Conditional Tool Execution:</strong> Only run necessary tools (1-3 calls vs always 3)</li>
        <li><strong>Database Indexing:</strong> Indexed columns for &lt;100ms query execution</li>
        <li><strong>Vector Store IndexFlatIP:</strong> Fast similarity search (50-100ms for k=5)</li>
      </ul>
    </div>
  </div>
</div>

<script>
function switchTab(tabName) {
  // Hide all panels
  const panels = document.querySelectorAll('.panel');
  panels.forEach(p => p.classList.remove('active'));

  // Remove active from all tabs
  const tabs = document.querySelectorAll('.tab');
  tabs.forEach(t => t.classList.remove('active'));

  // Show selected panel
  const panel = document.getElementById('panel-' + tabName);
  if (panel) panel.classList.add('active');

  // Mark tab as active
  event.target.classList.add('active');
}
</script>

</body>
</html>
